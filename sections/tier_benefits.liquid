{%- if section.settings.fullwidth -%}
  {%- assign container = 'container-full' -%}
{%- elsif section.settings.max_width != blank -%}
  {%- assign container = 'kretoss-container' -%}
{%- else -%}
  {%- assign container = 'page-width' -%}
{%- endif -%}

{%- assign max_width = '' -%}
{%- if section.settings.fullwidth == blank and section.settings.max_width != blank -%}
  {%- capture max_width -%}style="max-width: {{ section.settings.max_width }};"{%- endcapture -%}
{%- endif -%}

{% assign margin  = section.settings.margin | split: "|" %}
{% assign padding = section.settings.padding | split: "|" %}

{%- style -%}
#shopify-section-{{ section.id }} .section-project_tier_benefits{
  {% if margin[0] != blank %}margin: {{ margin[0] }};{% endif %}
  {% if padding[0] != blank %}padding: {{ padding[0] }};{% endif %}
}
@media (max-width:1200px){
  #shopify-section-{{ section.id }} .section-project_tier_benefits{
    {% if margin[1] != blank %}margin: {{ margin[1] }};{% endif %}
    {% if padding[1] != blank %}padding: {{ padding[1] }};{% endif %}
  }
}
@media (max-width:991px){
  #shopify-section-{{ section.id }} .section-project_tier_benefits{
    {% if margin[2] != blank %}margin: {{ margin[2] }};{% endif %}
    {% if padding[2] != blank %}padding: {{ padding[2] }};{% endif %}
  }
}
@media (max-width:767px){
  #shopify-section-{{ section.id }} .section-project_tier_benefits{
    {% if margin[3] != blank %}margin: {{ margin[3] }};{% endif %}
    {% if padding[3] != blank %}padding: {{ padding[3] }};{% endif %}
  }
}

{%- endstyle -%}

<div class="kretoss-section section-project_tier_benefits">
  <div class="{{ container }}" {{ max_width }}>
    <div class="tier_benefits_inner">
        <div class="tier_benefits_table">
            <div class="tier_benefits_head">
                <div> </div>
                {% for variant in product.variants %}
                <div>
                    <h2>{{ variant.title }}</h2>
                    <img src="{{ variant.metafields.custom.tier_image | image_url }}">
                </div>
                {% endfor %}
            </div>

            <div class="tier_benefits_body">
                {% for block in section.blocks %}
                    <div class="tier_benefits">
                        <div class="tier_features">
                            <div class="features_info">
                                <h4>{{ block.settings.title }}</h4>
                                <div class="description">
                                  {{ block.settings.short_text }}
                                  {% if block.settings.more_text != blank %}
                                      <span class="more_info"> Learn More</span>
                                      <div class="more_info_block">
                                      {{ block.settings.more_text }}
                                      </div>
                                  {% endif %}
                                </div>
                            </div>
                        </div>
                        {% for variant in product.variants %}
                            {% case forloop.index %}
                              {% when 1 %}
                                {% assign enabled = block.settings.tier_1 %}
                                {% assign custom_text = block.settings.tier_1_text %}
                              {% when 2 %}
                                {% assign enabled = block.settings.tier_2 %}
                                {% assign custom_text = block.settings.tier_2_text %}
                              {% when 3 %}
                                {% assign enabled = block.settings.tier_3 %}
                                {% assign custom_text = block.settings.tier_3_text %}
                              {% when 4 %}
                                {% assign enabled = block.settings.tier_4 %}
                                {% assign custom_text = block.settings.tier_4_text %}
                              {% when 5 %}
                                {% assign enabled = block.settings.tier_5 %}
                                {% assign custom_text = block.settings.tier_5_text %}
                              {% when 6 %}
                                {% assign enabled = block.settings.tier_6 %}
                                {% assign custom_text = block.settings.tier_6_text %}
                              {% else %}
                                {% assign enabled = false %}
                                {% assign custom_text = '' %}
                            {% endcase %}


                            <div class="tier_benefit_yes_no">
                              {% if custom_text != blank %}
                                <span class="tier_custom_text">{{ custom_text }}</span>
                              {% else %}
                                 <img src="{% if enabled %}{{ section.settings.icon_yes | image_url }}{% else %}{{ section.settings.icon_no | image_url }}{% endif %}" alt="{{ variant.title }}">
                              {% endif %}
                               
                            </div>
                        {% endfor %}
                        <div class="tier_mobile_description">{{ block.settings.more_text }}</div>
                    </div>  
                {% endfor %}
            </div>
        </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const tierItems = document.querySelectorAll('.tier_benefits');

  if (!tierItems.length) return;

  // Close all except first on load
  tierItems.forEach((item, index) => {
    const desc = item.querySelector('.tier_mobile_description');
    if (!desc) return;

    if (index === 0) {
      desc.style.display = 'block';
      item.classList.add('active');
    } else {
      desc.style.display = 'none';
    }
  });

  // Click handler
  tierItems.forEach(item => {
    const title = item.querySelector('.features_info h4');
    const desc = item.querySelector('.tier_mobile_description');

    if (!title || !desc) return;

    title.addEventListener('click', () => {
      const isOpen = item.classList.contains('active');

      // Close all
      tierItems.forEach(i => {
        i.classList.remove('active');
        const d = i.querySelector('.tier_mobile_description');
        if (d) d.style.display = 'none';
      });

      // Toggle current
      if (!isOpen) {
        desc.style.display = 'block';
        item.classList.add('active');
      }
    });
  });
});
</script>


{% schema %}
{
  "name": "Project Tier Benefits",
  "settings": [
    {
      "type": "header",
      "content": "Layout settings"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Width container",
      "info": "Default: 1296px"
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "Fullwidth"
    },
    {
      "type": "text",
      "id": "padding",
      "label": "Padding",
      "info": "desktop | 1200px | 991px | 767px"
    },
    {
      "type": "text",
      "id": "margin",
      "label": "Margin",
      "info": "desktop | 1200px | 991px | 767px"
    },
    {
      "type": "image_picker",
      "id": "icon_yes",
      "label": "Yes icon"
    },
    {
      "type": "image_picker",
      "id": "icon_no",
      "label": "No icon"
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Benefit row",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Benefit title"
        },
        {
          "type": "text",
          "id": "short_text",
          "label": "Short description"
        },
        {
          "type": "textarea",
          "id": "more_text",
          "label": "Learn more text"
        },
        {
          "type": "header",
          "content": "Select Yes or No",
          "info": "Please select yes no according your variant numbers no need to all."
        },
        {
          "type": "checkbox",
          "id": "tier_1",
          "label": "Tier 1 (Yes or No)"
        },
        {
          "type": "text",
          "id": "tier_1_text",
          "label": "Tier 1 Custom text"
        },
        {
          "type": "checkbox",
          "id": "tier_2",
          "label": "Tier 2 (Yes or No)"
        },
        {
          "type": "text",
          "id": "tier_2_text",
          "label": "Tier 2 Custom text"
        },
        {
          "type": "checkbox",
          "id": "tier_3",
          "label": "Tier 3 (Yes or No)"
        },
        {
          "type": "text",
          "id": "tier_3_text",
          "label": "Tier 3 Custom text"
        },
        {
          "type": "checkbox",
          "id": "tier_4",
          "label": "Tier 4 (Yes or No)"
        },
        {
          "type": "text",
          "id": "tier_4_text",
          "label": "Tier 4 Custom text"
        },
        {
          "type": "checkbox",
          "id": "tier_5",
          "label": "Tier 5 (Yes or No)"
        },
        {
          "type": "text",
          "id": "tier_5_text",
          "label": "Tier 5 Custom text"
        },
        {
          "type": "checkbox",
          "id": "tier_6",
          "label": "Tier 6 (Yes or No)"
        },
        {
          "type": "text",
          "id": "tier_6_text",
          "label": "Tier 6 Custom text"
        },
      ]
    }
  ],
  "presets": [
    {
      "name": "Project Tier Benefits"
    }
  ]
}
{% endschema %}
