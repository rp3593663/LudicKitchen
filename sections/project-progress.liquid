{%- if section.settings.fullwidth -%}
	{%- assign container = 'container-full' -%}
{%- elsif section.settings.max_width != blank -%}
	{%- assign container = 'kretoss-container' -%}
{%- else -%}
	{%- assign container = 'page-width' -%}
{%- endif -%}

{%- assign max_width = '' -%}
{%- if section.settings.fullwidth == blank and section.settings.max_width != blank -%}
	{%- assign width_container = section.settings.max_width | plus: 0 -%}
	{%- capture max_width -%}style="max-width: {{ section.settings.max_width }};"{%- endcapture -%}
{%- endif -%}

{% assign margin 	= section.settings.margin | split: "|" %}
{% assign padding 	= section.settings.padding | split: "|" %}
{%- style -%}
  {%- if margin[0] != blank or padding[0] != blank -%}
		#shopify-section-{{ section.id }} .section-project_progress_data{
			{%- if margin[0] != blank -%}margin: {{ margin[0] }};{%- endif -%}
			{%- if padding[0] != blank -%}padding:{{ padding[0] }};{%- endif -%}
		}
	{%- endif -%}
	{%- if margin[1] != blank or padding[1] != blank -%}
		@media (max-width:1200px){
			#shopify-section-{{ section.id }} .section-project_progress_data{
				{%- if margin[1] != blank -%}margin: {{ margin[1] }};{%- endif -%}
				{%- if padding[1] != blank -%}padding:{{ padding[1] }};{%- endif -%}
			}
		}
	{%- endif -%}
	{%- if margin[2] != blank or padding[2] != blank -%}
		@media (max-width:991px){
			#shopify-section-{{ section.id }} .section-project_progress_data{
				{%- if margin[2] != blank -%}margin: {{ margin[2] }};{%- endif -%}
				{%- if padding[2] != blank -%}padding:{{ padding[2] }};{%- endif -%}
			}
		}
	{%- endif -%}
	{%- if margin[3] != blank or padding[3] != blank -%}
		@media (max-width:767px){
			#shopify-section-{{ section.id }} .section-project_progress_data{
				{%- if margin[3] != blank -%}margin: {{ margin[3] }};{%- endif -%}
				{%- if padding[3] != blank -%}padding:{{ padding[3] }};{%- endif -%}
			}
		}
	{%- endif -%}



{%- endstyle -%}

<div class="kretoss-section section-project_progress_data">
	<div class="{{ container }}" {{ max_width }}>
        <div class="project_progress_inner">
            <div class="project_progress_left">
                {% assign raised_amount = product.metafields.custom.raised_amount | default: 0 %}
                {% assign goal_amount = product.metafields.custom.project_goal | default: 1 %}
                {% assign progress = raised_amount | times: 100.0 | divided_by: goal_amount | round: 2 %}
                {% if progress > 100 %}
                    {% assign progress = 100 %}
                {% endif %}

                {% assign bar_width = progress %}
                {% if bar_width < 2 %}
                    {% assign bar_width = 2 %}
                {% endif %}

                {% assign raised = raised_amount | times: 1.0 %}
                {% if raised >= 10000000 %}
                    {% assign raised_display = raised | divided_by: 10000000.0 | round: 2 | append: 'Cr' %}
                {% elsif raised >= 100000 %}
                    {% assign raised_display = raised | divided_by: 100000.0 | round: 1 | append: 'L' %}
                {% else %}
                    {% assign raised_display = raised | money_without_currency %}
                {% endif %}

                {% assign goal = goal_amount | times: 1.0 %}
                {% if goal >= 10000000 %}
                    {% assign goal_display = goal | divided_by: 10000000.0 | round: 2 | append: 'Cr' %}
                {% elsif goal >= 100000 %}
                    {% assign goal_display = goal | divided_by: 100000.0 | round: 1 | append: 'L' %}
                {% else %}
                    {% assign goal_display = goal | money_without_currency %}
                {% endif %}

                <div class="goal_progress">
                    <div class="progress_data">
                        <div class="goal_raised">
                            <h2>₹ {{ raised_display }}</h2>
                            <span>Raised till now</span>
                        </div>
                        <div class="goal_total">
                            <h2>₹ {{ goal_display }}</h2>
                            <span>Our total goal</span>
                        </div>
                    </div>
                    <div class="raised_progress_bar">
                        <div class="raised_progress_track">
                            <div class="progress_fill" style="width: {{ bar_width }}%;"> </div>
                            <div class="milestone-75">
                                <span class="milestone-tooltip">Production starts from here</span>
                            </div>
                        </div>
                    </div>
                    <div class="total_raised_percentage">
                        <h3>{{ progress }}%</h3><span>Raised</span>
                    </div>
                    <p class="goal_info">Project activates once we hit <span>75%</span> of the goal. Until then, the project stays in the planning stage. The project stays in the planning stage.</p>
                </div>
            </div>
            <div class="project_progress_right">
                <div class="top_data">
                    <div class="total_backers_data">
                        {% assign current_backers = 500 %}
                        {% assign target_backers = 1000 %}
                        {% assign backers_progress = current_backers | times: 100.0 | divided_by: target_backers | round: 2 %}
                        {% if backers_progress > 100 %}
                            {% assign backers_progress = 100 %}
                        {% endif %}
                        {% assign backers_bar_width = backers_progress %}
                        {% if backers_bar_width < 2 %}
                            {% assign backers_bar_width = 2 %}
                        {% endif %}
                        <h4>Total Backers</h4>
                        <div class="raised_progress_bar">
                            <div class="total_backers_track">
                                <div class="total_backers_progress_fill" style="width: {{ backers_bar_width }}%;"> </div>
                            </div>
                        </div>
                        <div class="total_backers_percentage">
                            <h3>{{ current_backers }}</h3>
                            <span>of {{ target_backers }} Backers</span>
                        </div>
                    </div>  
                </div>
                <div class="bottom_data">
                    <div class="days-gauge">
                        <div class="gauge-header">
                            <h3>Days</h3>
                            <span class="early-end">Early ends in <strong>5 Days</strong></span>
                        </div>

                        <div class="gauge-wrapper">
  <svg viewBox="0 0 200 120" class="gauge-svg">

    <!-- TICKS -->
    <g id="gaugeTicks"></g>

    <!-- BACKGROUND ARC -->
    <path
      d="M20 100 A80 80 0 0 1 180 100"
      fill="none"
      stroke="#e5e5e5"
      stroke-width="6"
      pathLength="80"
    />

    <!-- PROGRESS ARC -->
    <path
      id="progressArc"
      d="M20 100 A80 80 0 0 1 180 100"
      fill="none"
      stroke="#1e6bff"
      stroke-width="6"
      stroke-linecap="round"
      pathLength="80"
      stroke-dasharray="0 100"
    />
  </svg>

  <div class="gauge-center">
    <h2 id="daysLeft">15</h2>
    <span>Days left</span>
  </div>
</div>

                    </div>
                </div>
            </div>
        </div>
	</div>
</div>
{% comment %} <script>
  const TOTAL_DAYS = 60;
  const DAYS_LEFT = 15;

  const progressPercent = (DAYS_LEFT / TOTAL_DAYS) * 100;

  // Progress arc
  document
    .getElementById("progressArc")
    .setAttribute("stroke-dasharray", `${progressPercent} 100`);

  document.getElementById("daysLeft").innerText = DAYS_LEFT;

  // -------- TICKS --------
  const ticksGroup = document.getElementById("gaugeTicks");
  const TICK_COUNT = 40; // more = denser ticks
  const centerX = 100;
  const centerY = 100;
  const radiusOuter = 92;
  const radiusInnerSmall = 86;
  const radiusInnerBig = 82;

  for (let i = 0; i <= TICK_COUNT; i++) {
    const angle = Math.PI * (i / TICK_COUNT); // 180°
    const cos = Math.cos(Math.PI - angle);
    const sin = Math.sin(Math.PI - angle);

    const isMajor = i % 5 === 0;

    const x1 = centerX + radiusOuter * cos;
    const y1 = centerY - radiusOuter * sin;

    const x2 = centerX + (isMajor ? radiusInnerBig : radiusInnerSmall) * cos;
    const y2 = centerY - (isMajor ? radiusInnerBig : radiusInnerSmall) * sin;

    const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
    tick.setAttribute("x1", x1);
    tick.setAttribute("y1", y1);
    tick.setAttribute("x2", x2);
    tick.setAttribute("y2", y2);
    tick.setAttribute(
      "stroke",
      i / TICK_COUNT * 100 <= progressPercent ? "#1e6bff" : "#111"
    );
    tick.setAttribute("stroke-width", isMajor ? "2" : "1");
    tick.setAttribute("stroke-linecap", "round");

    ticksGroup.appendChild(tick);
  }
</script> {% endcomment %}
<script>
  const TOTAL_DAYS = 60;
  const DAYS_LEFT = 15;

  const progressPercent = (DAYS_LEFT / TOTAL_DAYS) * 100;

  document
    .getElementById("progressArc")
    .setAttribute("stroke-dasharray", `${progressPercent} 100`);

  document.getElementById("daysLeft").innerText = DAYS_LEFT;

  // ---------- TICKS ----------
  const ticksGroup = document.getElementById("gaugeTicks");
  const TICK_COUNT = 36;

  const cx = 100;
  const cy = 100;

  // GAP BETWEEN ARC & TICKS
  const outerRadius = 98;
  const innerMinor = 90;
  const innerMajor = 90;

  for (let i = 0; i <= TICK_COUNT; i++) {
    const angle = Math.PI * (i / TICK_COUNT);
    const cos = Math.cos(Math.PI - angle);
    const sin = Math.sin(Math.PI - angle);

    const isMajor = i % 5 === 0;

    const x1 = cx + outerRadius * cos;
    const y1 = cy - outerRadius * sin;

    const x2 = cx + (isMajor ? innerMajor : innerMinor) * cos;
    const y2 = cy - (isMajor ? innerMajor : innerMinor) * sin;

    const tick = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "line"
    );

    tick.setAttribute("x1", x1);
    tick.setAttribute("y1", y1);
    tick.setAttribute("x2", x2);
    tick.setAttribute("y2", y2);

    // STYLE MATCHING IMAGE-2
    tick.setAttribute("stroke", isMajor ? "#1e6bff" : "#000");
    tick.setAttribute("stroke-width", isMajor ? "2" : "1");
    tick.setAttribute("stroke-linecap", "round");

    ticksGroup.appendChild(tick);
  }
</script>


{% schema %}
{
  "name": "Project Progress Data",
  "settings": [
    {
      "type": "header",
      "content": "Layout settings"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Width container",
      "info": "Default: 1296px"
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "Fullwidth"
    },
    {
      "type": "text",
      "id": "padding",
      "label": "Padding",
      "placeholder": "0px 0px 0px 0px",
      "info":"Screen: desktop | 1200px | 991px | 767px"
    },
    {
      "type": "text",
      "id": "margin",
      "label": "Margin",
      "placeholder": "0px 0px 0px 0px",
      "info":"Screen: desktop | 1200px | 991px | 767px"
    }
  ],
	"presets": [
		{
			"name": "Project Progress Data"
		}
    ]
}
{% endschema %}