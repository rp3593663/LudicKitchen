{%- if section.settings.fullwidth -%}
	{%- assign container = 'container-full' -%}
{%- elsif section.settings.max_width != blank -%}
	{%- assign container = 'kretoss-container' -%}
{%- else -%}
	{%- assign container = 'page-width' -%}
{%- endif -%}

{%- assign max_width = '' -%}
{%- if section.settings.fullwidth == blank and section.settings.max_width != blank -%}
	{%- assign width_container = section.settings.max_width | plus: 0 -%}
	{%- capture max_width -%}style="max-width: {{ section.settings.max_width }};"{%- endcapture -%}
{%- endif -%}

{% assign margin 	= section.settings.margin | split: "|" %}
{% assign padding 	= section.settings.padding | split: "|" %}
{%- style -%}
  {%- if margin[0] != blank or padding[0] != blank -%}
		#shopify-section-{{ section.id }} .section-home-animation{
			{%- if margin[0] != blank -%}margin: {{ margin[0] }};{%- endif -%}
			{%- if padding[0] != blank -%}padding:{{ padding[0] }};{%- endif -%}
		}
	{%- endif -%}
	{%- if margin[1] != blank or padding[1] != blank -%}
		@media (max-width:1200px){
			#shopify-section-{{ section.id }} .section-home-animation{
				{%- if margin[1] != blank -%}margin: {{ margin[1] }};{%- endif -%}
				{%- if padding[1] != blank -%}padding:{{ padding[1] }};{%- endif -%}
			}
		}
	{%- endif -%}
	{%- if margin[2] != blank or padding[2] != blank -%}
		@media (max-width:991px){
			#shopify-section-{{ section.id }} .section-home-animation{
				{%- if margin[2] != blank -%}margin: {{ margin[2] }};{%- endif -%}
				{%- if padding[2] != blank -%}padding:{{ padding[2] }};{%- endif -%}
			}
		}
	{%- endif -%}
	{%- if margin[3] != blank or padding[3] != blank -%}
		@media (max-width:767px){
			#shopify-section-{{ section.id }} .section-home-animation{
				{%- if margin[3] != blank -%}margin: {{ margin[3] }};{%- endif -%}
				{%- if padding[3] != blank -%}padding:{{ padding[3] }};{%- endif -%}
			}
		}
	{%- endif -%}
   .horizontal-section {
      position: relative;
      height: auto;
      overflow: hidden;
    }

    .horizontal-wrapper {
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 158px;
    }


    .horizontal-title {
        white-space: nowrap;
        font-weight: 700;
        font-size: 96px;
        line-height: 96px;
        letter-spacing: -4.8px;
        margin: 0px;
        color: var(--primary_color);
    }

    .horizontal-desc {
        margin: 0px;
        max-width: 428px;
        font-weight: 500;
        font-size: 20px;
        line-height: 31px;
        letter-spacing: -1px;
        text-align: center;
    }
    svg.horizontal-words__arrow-end-svg {
      position: absolute;
      top: 50%;
      left: 100%;
      transform: translate(50%);
  }
    @media(max-width: 767px){
      .horizontal-title {
          font-size: 56px;
          letter-spacing: -2.8px;
      }
      .horizontal-wrapper {
          gap: 99px;
      }
      .horizontal-desc {
          max-width: 339px;
          font-size: 16px;
          line-height: 22px;
          letter-spacing: -0.8px;
      }
      .horizontal-wrapper {
        height: 100svh !important; /* mobile-safe viewport */
      }

      @supports not (height: 100svh) {
        .horizontal-wrapper {
          height: 100vh;
        }
      }

    }
{%- endstyle -%}
<div class="kretoss-section section-home-animation video-trigger-section"
   {% if section.settings.section_video != blank %}
    data-video-src="{{ section.settings.section_video.sources[0].url }}"
    data-thumb="{{ section.settings.section_video_poster | image_url }}"
    data-title="{{ section.settings.section_video_title | escape }}"
    data-text="{{ section.settings.section_video_text }}"
    data-popup-title="{{ section.settings.section_popup_title | escape }}"
    data-popup-text="{{ section.settings.section_popup_text | replace: '"', '&quot;' }}"
  {% endif %}>
	<div class="{{ container }}" {{ max_width }}>
        <div class="horizontal-section">
            <div class="horizontal-wrapper">
                <h2 class="horizontal-title">
                    It's yours, curation to creation.<svg width="66" height="74" viewBox="0 0 66 74" fill="none" xmlns="http://www.w3.org/2000/svg" class="horizontal-words__arrow-end-svg">
                      <path d="M1.09229 1.41119C47.2792 1.41119 61.2083 30.5451 55.7097 72.8801L46.9125 62.8656" stroke="#214ECF" stroke-width="2.1842" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M1.09229 1.41119C47.2792 1.41119 61.2083 30.5451 55.7102 72.8801L64.8741 64.2309" stroke="#214ECF" stroke-width="2.1842" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </h2>
                <p class="horizontal-desc">
                  Control, contribute, create - right from the first move to last output, we'll match your cue.
                </p>
            </div>
        </div>
	</div>
</div>
<script>
gsap.registerPlugin(ScrollTrigger, SplitText, DrawSVGPlugin);

document.fonts.ready.then(() => {

  const section = document.querySelector(".horizontal-section");
  const wrapper = document.querySelector(".horizontal-wrapper");
  const title   = document.querySelector(".horizontal-title");

  const split = new SplitText(title, { type: "chars" });

  // Move title horizontally
  {% comment %} gsap.set(title, { xPercent: 100 }); {% endcomment %}
   gsap.set(title, { 
    xPercent: window.innerWidth < 768 ? 60 : 100 
  });


  const horizontalTween = gsap.to(title, {
    {% comment %} xPercent: -60, {% endcomment %}
     xPercent: window.innerWidth < 768 ? -30 : -60,
    ease: "none",
    scrollTrigger: {
      trigger: section,
      start: () => window.innerWidth < 768 ? "top 70%" : "top top",
      {% comment %} start: "top top",
      end: () => "+=" + (window.innerWidth + title.scrollWidth), {% endcomment %}
       end: () => {
          if (window.innerWidth < 768) {
            return "+=" + window.innerWidth * 1.2; // SHORT mobile scroll
          }
          return "+=" + (window.innerWidth + title.scrollWidth);
        },
      scrub: true,
      pin: wrapper,
      anticipatePin: 1
    }
  });

  // âœ¨ Letter animation (already working)
  split.chars.forEach(char => {
    gsap.from(char, {
      yPercent: (Math.random() - 0.5) * 300,
      rotation: (Math.random() - 0.5) * 60,
      ease: "elastic.out(1.2, 1)",
      scrollTrigger: {
        trigger: char,
        containerAnimation: horizontalTween,
        start: "left 80%",
        end: "left 20%",
        scrub: true
      }
    });
  });

  // ðŸ‘‰ ARROW SVG DRAW ANIMATION
  const arrowPaths = document.querySelectorAll(
    ".horizontal-words__arrow-end-svg path"
  );

  gsap.set(arrowPaths, {
    drawSVG: "0% 0%"
  });

  gsap.to(arrowPaths, {
    drawSVG: "0% 100%",
    ease: "none",
    scrollTrigger: {
      trigger: arrowPaths[0],
      containerAnimation: horizontalTween,
      start: "left 90%",
      end: "left 50%",
      scrub: 0.5
    }
  });

  // ðŸ‘‰ DESCRIPTION FADE-UP ANIMATION
  const desc = document.querySelector(".horizontal-desc");

  // initial hidden state
  gsap.set(desc, {
    opacity: 0,
    y: 40
  });

  gsap.to(desc, {
    opacity: 1,
    y: 0,
    ease: "power2.out",
    scrollTrigger: {
      trigger: arrowPaths[0],            // sync with arrow
      containerAnimation: horizontalTween,
      start: "left 55%",                 // when arrow reaches center-ish
      end: "left 35%",
      scrub: true
    }
  });
});
</script>

{% schema %}
{
  "name": "Home Animation",
  "settings": [
    {
      "type": "header",
      "content": "Layout settings"
    },
    {
      "type": "text",
      "id": "max_width",
      "label": "Width container",
      "info": "Default: 1296px"
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "Fullwidth"
    },
    {
      "type": "text",
      "id": "padding",
      "label": "Padding",
      "placeholder": "0px 0px 0px 0px",
      "info":"Screen: desktop | 1200px | 991px | 767px"
    },
    {
      "type": "text",
      "id": "margin",
      "label": "Margin",
      "placeholder": "0px 0px 0px 0px",
      "info":"Screen: desktop | 1200px | 991px | 767px"
    },
    {
      "type": "video",
      "id": "section_video",
      "label": "Section Video"
    },
    {
      "type": "image_picker",
      "id": "section_video_poster",
      "label": "Video Poster / Thumbnail"
    },
    {
      "type": "text",
      "id": "section_video_title",
      "label": "Sticky Video Title",
      "default": "How this works"
    },
    {
      "type": "text",
      "id": "section_video_text",
      "label": "Sticky Video Text",
      "default": "Get a better understanding of how ludic kitchen works."
    },
    {
        "type": "text",
        "id": "section_popup_title",
        "label": "Popup Title",
        "default": "How Kitchen works"
    },
    {
        "type": "textarea",
        "id": "section_popup_text",
        "label": "Popup Text",
        "default": "Many hands, one shared intention. Every project here follows a simple path..."
    }
  ],
	"presets": [
		{
			"name": "Home Animation"
		}
    ]
}
{% endschema %}